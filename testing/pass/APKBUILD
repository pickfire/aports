# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: Johannes Matheis <jomat+alpinebuild@jmt.gr>
# Maintainer: Johannes Matheis <jomat+alpinebuild@jmt.gr>
pkgname=pass
pkgver=1.7
pkgrel=0
pkgdesc="Stores, retrieves, generates, and synchronizes passwords securely"
url="http://zx2c4.com/projects/password-store/"
arch="noarch"
license="GPL2"
depends="bash"
depends_dev=""
makedepends="$depends_dev"
install=""
subpackages="$pkgname-doc
	$pkgname-contrib
	$pkgname-bash-completion:bashcomp
	$pkgname-fish-completion:fishcomp
	$pkgname-zsh-completion:zshcomp"
source="http://git.zx2c4.com/password-store/snapshot/password-store-${pkgver}.tar.xz"

_builddir="$srcdir/password-store-$pkgver"
package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" \
		FORCE_BASHCOMP=1 \
		FORCE_ZSHCOMP=1 \
		FORCE_FISHCOMP=1 install
}

contrib() {
	pkgdesc="contrib files for pass"
	mkdir -p "$subpkgdir"/usr/share
	cp -a "$_builddir"/contrib "$subpkgdir"/usr/share/$pkgname
}

bashcomp() {
	depends=""
	pkgdesc="Bash completions for $pkgname"
	install_if="$pkgname=$pkgver-r$pkgrel bash-completion"
	arch="noarch"

	mkdir -p "$subpkgdir"/usr/share/bash-completion/completions
	mv "$pkgdir"/usr/share/bash-completion/completions/* \
		"$subpkgdir"/usr/share/bash-completion/completions/ || return 1
}

fishcomp() {
	depends=""
	pkgdesc="Fish completions for $pkgname"
	install_if="$pkgname=$pkgver-r$pkgrel fish"
	arch="noarch"

	mkdir -p "$subpkgdir"/usr/share/fish/completions/
	mv "$pkgdir"/usr/share/fish/vendor_completions.d/* \
		"$subpkgdir"/usr/share/fish/completions/ || return 1
}

zshcomp() {
	depends=""
	pkgdesc="Zsh completions for $pkgname"
	install_if="$pkgname=$pkgver-r$pkgrel zsh"
	arch="noarch"

	mkdir -p "$subpkgdir/usr/share/zsh/site-functions"
	mv "$pkgdir"/usr/share/zsh/site-functions/* \
		"$subpkgdir"/usr/share/zsh/site-functions || return 1
}

sha512sums="f31fd067f9c6134eac7bb5039df6de3d6fe25c9fcd16d27a0cba159bd7fa9361193081a1fff2000cba1943edbb324e645c6399d4f4aa9f441dd9c67696462a50  password-store-1.7.tar.xz"
